fs = require \fs
request = require \request
{Cards, couch} = require \../../data

{origin} = couch

console.log "fetching data from #origin"

options =
  json: true
  uri: "#origin/draft/_design/draft/_view/score?group=true"

request options, (err, res, data) ->
  throw err if err
  for {key, value} of data.rows
    lc = key.toLowerCase!
    Cards[lc]?score = value.sum / value.count
  fs.writeFileSync \data/cards.json JSON.stringify Cards, null 2
